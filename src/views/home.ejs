<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/home.css">
    <!-- <script src="/javascript/map.js"></script> -->
    <link rel="stylesheet" href="/css/map.css">
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Home</title>
    <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
</head>
<body>
    <header class="main-header">
      <div class="logo-container">
          <img src= "https://cdn.haitrieu.com/wp-content/uploads/2021/11/Logo-DH-Kien-Giang-VNKGU.png" alt="Logo" class="logo">
      </div>
      <h1 class="site-title">Hệ thống thông tin địa lý</h1>
      <div class="user-avatar">
          <% if (locals.user) { %>
              <div class="avatar-container">
                  <img src="<%= user.avatar || 'https://i.pinimg.com/564x/f5/f7/6b/f5f76bf874cd941b271bdda2288ead52.jpg' %>" alt="User Avatar" class="avatar-img">
                  <div class="user-menu">
                      <span class="user-name"><%= user.fullname %></span>
                      <a href="/logout" class="logout-button">Đăng xuất <i class="fa-solid fa-right-from-bracket"></i></a>
                  </div>
              </div>
          <% } else { %>
              <a href="/login" class="login-link">Đăng nhập</a>
          <% } %>
      </div>
    </header>

    <div class="input-button-value">
        <input type="button" id="getValues" value="getValues">
        <input type="button" id="changeValues" value="changeValues">
    </div>
      
    <div id="map"></div>

    <div>
        <h1>Cửa hàng</h1>
        <div class="store-container">
            <% stores.forEach(function(store) { %>
                <div class="store-card">
                    <h2><%= store.name_store %></h2>
                    <p><%= store.address %></p>
                    <p><%= store.latitude %></p>
                    <p><%= store.longitude %></p>
                </div>
            <% }); %>
        </div>
    </div>

  <script>
    (function() {
        window.onload = function() {
            // Creating an object literal containing the properties we want to pass to the map  
            var options = {
                zoom: 12,
                center: new google.maps.LatLng(9.9997671, 105.0932218),
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
        
            // Creating the map  
            var map = new google.maps.Map(document.getElementById('map'), options);
            
            // Array to store all markers and infowindows
            var markersArray = [];
            
            <% stores.forEach(function(store) { %>
                var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(<%= store.latitude %>, <%= store.longitude %>),
                    map: map,
                    title: '<%= store.name_store %>'
                });
                
                var infowindow = new google.maps.InfoWindow({
                    content: '<h3><%= store.name_store %></h3><p><%= store.address %></p>'
                });
                
                // Store the marker and infowindow in the array
                markersArray.push({marker: marker, infowindow: infowindow});
            <% }); %>

            // Add click listeners to all markers
            markersArray.forEach(function(markerObj) {
                google.maps.event.addListener(markerObj.marker, 'click', function() {
                    // Close all open infowindows
                    markersArray.forEach(function(obj) {
                        obj.infowindow.close();
                    });
                    // Open this marker's infowindow
                    markerObj.infowindow.open(map, markerObj.marker);
                });
            });

            // Add a click event to the map to close all infowindows
            google.maps.event.addListener(map, 'click', function() {
                markersArray.forEach(function(obj) {
                    obj.infowindow.close();
                });
            });
        };
    })();
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>    
</html>
